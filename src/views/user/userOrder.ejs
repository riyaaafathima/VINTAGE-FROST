<!DOCTYPE html>
<html lang="en">
  <!-- molla/product.html  22 Nov 2019 09:54:50 GMT -->
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Molla - Bootstrap eCommerce Template</title>
    <meta name="keywords" content="HTML5 Template" />
    <meta name="description" content="Molla - Bootstrap eCommerce Template" />
    <meta name="author" content="p-themes" />
    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/card-assets/images/icons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/card-assets/images/icons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/card-assets/images/icons/favicon-16x16.png"
    />
    <link rel="manifest" href="/card-assets/images/icons/site.html" />
    <link
      rel="mask-icon"
      href="/card-assets/images/icons/safari-pinned-tab.svg"
      color="#666666"
    />
    <link rel="shortcut icon" href="/card-assets/images/icons/favicon.ico" />
    <meta name="apple-mobile-web-app-title" content="Molla" />
    <meta name="application-name" content="Molla" />
    <meta name="msapplication-TileColor" content="#cc9966" />
    <meta
      name="msapplication-config"
      content="/card-assets/images/icons/browserconfig.xml"
    />
    <meta name="theme-color" content="#ffffff" />
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="/card-assets/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="/card-assets/css/plugins/owl-carousel/owl.carousel.css"
    />
    <link
      rel="stylesheet"
      href="/card-assets/css/plugins/magnific-popup/magnific-popup.css"
    />
    <!-- Main CSS File -->
    <link rel="stylesheet" href="/card-assets/css/style.css" />
    <link
      rel="stylesheet"
      href="/card-assets/css/plugins/nouislider/nouislider.css"
    />
  </head>

  <body>
    <div class="page-wrapper">
      <%- include('partials/header.ejs') %>
      <!-- End .header -->



      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Order Details</title>
          <!-- Bootstrap CSS -->
          <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
          <style>
              :root {
                  --theme-color: #AD9170;
              }
              body {
                  background-color: #f8f9fa;
              }
              .header-section {
                  background-color: var(--theme-color);
                  color: white;
                  padding: 20px 90px;
                  margin-bottom: 30px;
              }
              .order-heading, .review-heading, .related-heading {
                  font-family: monospace;
                  font-weight: bold;
                  margin: 20px 0;
                  color: #333;
              }
              .item-box {
                  border: 1px solid #dee2e6;
                  border-radius: 5px;
                  margin-bottom: 20px;
                  padding: 15px;
                  background-color: white;
              }
              .product-image {
                  max-width: 100%;
                  height: auto;
              }
              .status-returned {
                  color: rgb(231, 206, 19);
                  font-weight: bold;
              }
              .btn-cancel{
                background-color: #CC9966;
                  color: #333;
                  border: 1px solid #dee2e6;
                  padding:10px 20px;
                  margin-top: 100px;
                  
              }
              .btn-cancel:hover{
                background-color: wheat;
              }
              .status-delivered {
                  color: rgb(106, 158, 106);
                  font-weight: bold;
              }
              .status-canceled {
                  color: #dc3545;
                  font-weight: bold;
              }
              .original-price {
                  text-decoration: line-through;
                  color: #6c757d;
              }
              .current-price {
                  color: var(--theme-color);
                  font-weight: bold;
              }
              .btn-download {
                  background-color: white;
                  color: #333;
                  border: 1px solid #dee2e6;
              }
              .btn-view {
                  background-color:#CC9966;
                  color: #333;
                  border: 1px solid #dee2e6;
                  padding:10px 20px;
                  margin-top: 100px;
              }
              .btn-view:hover{
               background-color: wheat;
              }
              .btn-update {
                  color: blue;
                  text-decoration: underline;
                  background: none;
                  border: none;
                  font-weight: bold;
              }
              .star-rating {
                  color: var(--theme-color);
              }
              .review-date {
                  color: #6c757d;
                  font-size: 0.9rem;
              }
              .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 70%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .close {
            cursor: pointer;
            font-size: 24px;
        }

        .modal-body textarea {
            width: 100%;
            min-height: 150px;
            margin-bottom: 15px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .mssg-btns {
            margin: 20px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .save-btn {
            background-color: #AD9170;
            color: white;
        }

        .close-btn {
            background-color: #AD9170;
            color: white;
        }
        
        


        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }


        .reason-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .reason-modal-content {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      border-top: 5px solid #CC9966;
    }
    
    .reason-modal h3 {
      margin-top: 0;
      color: #CC9966;
      font-size: 22px;
      margin-bottom: 20px;
    }
    
    #reasonInput {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      min-height: 100px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
      box-sizing: border-box;
      resize: vertical;
    }
    
    #reasonInput:focus {
      outline: none;
      border-color: #CC9966;
    }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    #submitReason {
      background-color: #CC9966;
      color: white;
      margin-right: 10px;
    }
    
    #submitReason:hover {
      background-color: #BF8855;
    }
    
    #closeModal {
      background-color: #eee;
      color: #333;
    }
    
    #closeModal:hover {
      background-color: #ddd;
    }
    
    /* For demo purposes */
    #openModal {
      margin: 20px;
      background-color: #CC9966;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

          </style>
      </head>
      <body>
          <div class="container-fluid p-0">
              <!-- Header Section -->
              <div class="header-section d-flex justify-content-between align-items-center">
                
                  <div>
                      <p class="mb-0" style="color: white;"><h1>Sent to :</h1></p>
                      <p class="mb-0"style="color: white;"><%=order.address.state%> , <%=order.address.city%></p>
                      <p class="mb-0"style="color: white;"><%=order.address.name%> , <%=order.address.place%></p>
                      <p class="mb-0"style="color: white;"><%=order.address.address%> <%=order.address.addressType%></p>
                      <p class="mb-0"style="color: white;"><%=order.address.phoneNumber%></p>
                      <p class="mb-0"style="color: white;"><%=order.address.landmark%></p>
                      <p class="mb-0"style="color: white;"><%=order.address.pincode%>,<%=order.address.locality%></p>
                  </div>
                  <div>
                      <p class="mb-2" style="color: white;">Download Invoice:</p>
                      <button class="btn btn-download">Download</button>
                  </div>
              </div>
      
              <!-- Order Details Section -->
              <div class="container">
                  <h1 class="order-heading text-center">Here's what you ordered:</h1>
                  <p>Order id:<%=order.orderId%></p>
      
                  <div class="row mt-4">
                      <div class="col-12">
                          <div class="item-box">
                              <div class="row">
                                  <div class="col-md-2">
                                      <img src="/uploads/<%=order.selectedProduct.image[0]%>" alt="Roadster Shoe" class="product-image">
                                  </div>
                                  <div class="col-md-7">
                                      <h2> <%=order.selectedProduct.product%></h2>
                                      <p>KG: <%=order.selectedProduct.kg%></p>
                                    
                                      <!-- <p> <%=order.selectedProduct.product%></p> -->
                                      <p>
                                        <%if(order.selectedProduct.offerPrice){%>
                                          <span class="current-price">₹<%=order.selectedProduct.offerPrice%></span>
                                          <span class="original-price">₹<%=order.selectedProduct.actualPrice%></span>
                                          
                                       <% }else{%>
                                        <span class="current-price">₹<%=order.selectedProduct.price%></span>

                                        <%}%>
                                      </p>
                                      <div class="mssg-btns" style="display: flex; gap:10px;">
                                        <button id="instruction-Btn" data-instruction="<%=order.selectedProduct.instruction%>" >view instruction</button>
                                        <button id="mssg-btn" data-mssg="<%=order.selectedProduct.message%>" >view message</button>
                                    </div>
                                      <p class="status-returned"> <%=order.selectedProduct.status%></p>
                                  </div>
                                  <div class="col-md-3 text-end">
                                      <div class="d-flex flex-column h-100">
                                        <% if(order.selectedProduct.status === 'Pending') { %>
                                            <button 
                                              class="btn btn-cancel"
                                              data-order-id="<%= order._id %>"
                                              data-product-id="<%= order.selectedProduct.productId %>"
                                              data-id="<%= order.selectedProduct._id %>"

                                            >
                                              Cancel
                                            </button>
                                          <% } %>
                                          <span class="status-text"><%= order.selectedProduct.status %></span>
                                          

                                          

                                          <div>
                                              <p class="mb-0">Qty: <%=order.selectedProduct.quantity%></p>
                                              <!-- <p class="mb-0">Actual-price: <%=order.selectedProduct.actualPrice%></p> -->
                                              <p class="mb-0">TOTAL-COST: ₹<%=order.selectedProduct.price%></p>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>



<!-- ///////////////////////////////////////////reason modal/////////////////////////////////////////////////////////// -->


<div id="reasonModal" class="reason-modal">
  <div class="reason-modal-content">
    <h3>Why do you want to cancel?</h3>
    <textarea   id="reasonInput"  placeholder="Enter your reason..."  ></textarea>
    <div>
      <button id="submitReason">Submit</button>
      <button id="closeModal">Close</button>
    </div>
  </div>
</div>

                  <!-- ////////////////////////modaal///////////////////////////////////// -->



                  <div id="myModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 id="modalTitle">Modal Title</h2>
                            <span class="close" onclick="closeModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                           
                                <textarea style="background: #f0f0f0; color: #333;" id="modalTextarea" placeholder=""></textarea>
                             
               
                        </div>
                        <div class="modal-footer">
                            <!-- <button class="save-btn" onclick="saveChanges()">Save changes</button>
                            <button class="close-btn" onclick="closeModal()">Close</button> -->
                        </div>
                    </div>
                </div>
      
                  <!-- Review Section --> 
                  h2 class="review-heading text-center">Here's your review</h2>
                  <div class="item-box">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                          <div class="review-date">
                              karma user, - Tue Jul 23 2024
                          </div>
                          <button class="btn-update">UPDATE</button>
                      </div>
                      <div class="star-rating mb-2">
                          ★ ★ ★ ★ ★
                      </div>
                      <p>good quality product</p>
                  </div>
      
                  <!-- Related Items Section -->
                 <%if(order.items.length>0){%>
                  <h1 class="related-heading">Other items in your order</h1>
                 
                 
                  <%order.items.forEach((item)=>{%>

                  <div class="item-box">
                      <div class="row">
                          <div class="col-md-2">
                              <img src="/uploads/<%=item.image[0]%>" alt="NMD R1 Shoes" class="product-image">
                          </div>
                          <div class="col-md-7">
                              <h2><%=item.product%></h2>
                              <p>kg: <%=item.kg%></p>
                              <p>kg: <%=item.actualPrice%></p>
                                    <%if(item.status=="Pending"){%>

                              <p class="status-returned"><%=item.status%></p>

                              <%}else if(item.status=="Cancelled"){%>
                                <p class="status-canceled"><%=item.status%></p>
                                
                                <% }else if(item.status=="Delivered"){%>
                                 <p class="status-delivered"><%=item.status%></p>

                                <%}%>
                          </div>
                          <div class="col-md-3 text-end">
                              <div class="d-flex flex-column h-100 justify-content-between">
                                  <div>
                                    <a href="/view-orderDetails/<%=order._id%>/<%=item._id%>">
                                                <button  class="btn btn-view">View</button>
                                     </a>
                                  </div>
                                  <div>
                                      <p class="mb-2">Qty: <%=item.quantity%></p>
                                      <p class="mb-2">Price :<%=item.actualPrice%></p>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <% })%>
              <%}%>
              <!-- Footer -->
               
              <%- include('partials/footer.ejs') %>

      
          <script>
const cancel_btn_el = document.querySelector('.btn-cancel');
const instruction_el = document.querySelectorAll("#instruction-Btn");
const mssg_el = document.querySelectorAll("#mssg-btn");

const reason_modal=document.getElementById('reasonModal');
const openBtn = document.getElementById('openModal');
const close_modal=document.getElementById('closeModal');
const reason_input=document.getElementById('reasonInput');
const submit_reason_btn_el=document.getElementById('submitReason');

const orderId = cancel_btn_el.getAttribute('data-order-id');
   const productId = cancel_btn_el.getAttribute('data-product-id');
   const itemId = cancel_btn_el.getAttribute('data-id');


  cancel_btn_el.addEventListener('click', async (e) => {
    e.preventDefault();
    reason_modal.style.display='flex'

close_modal.addEventListener('click',(e)=>{
  reason_modal.style.display='none'
})
submit_reason_btn_el.addEventListener('click',async(e)=>{
  e.preventDefault()
  const reason=reason_input.value
  console.log(reason);
  

  if (reason) {
    try {
          const response = await fetch(`/order/cancel/${orderId}/${productId}/${itemId}`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body:JSON.stringify({reason})
          });

          if (response.ok) {

            
      Swal.fire({
        position: "center",
        icon: "success",
        title: "saved your message",
        showConfirmButton: false,
        timer: 1500,
      }).then(() => {
     // Remove the button after successful cancel
     cancel_btn_el.remove();

// Optionally, update status text
const statusElement = document.querySelector('.status-text');
if (statusElement) {
  // window.location.reload()
   reason_modal.style.display='none'
  statusElement.textContent = 'Cancelled';
}
        
      });

          }

        } catch (error) {
          console.log(error);
        }
      }}
)})


   


   


 


    
      




const modal = document.getElementById("myModal");
const modalTitle = document.getElementById("modalTitle");
const textarea = document.getElementById("modalTextarea");

function openModal(type) {
  modal.style.display = "block";
  modalTitle.textContent =
    type === "instruction" ? "View Instruction" : "View Message";
}

function closeModal() {
  modal.style.display = "none";
}

function saveChanges() {
  console.log("Saving:", textarea.value);
  closeModal();
}

// Close modal when clicking outside
window.onclick = function (event) {
  if (event.target === modal) {
    closeModal();
  }
};

instruction_el.forEach((el) => {
  el.addEventListener("click", (e) => {

       textarea.setAttribute("data-type", "instruction");
   
    textarea.innerHTML = el.getAttribute("data-instruction");


    openModal("instruction");
  });
});

mssg_el.forEach((el) => {
  el.addEventListener("click", (e) => {

  
    textarea.setAttribute("data-type", "message");
    textarea.innerHTML = el.getAttribute("data-mssg");
    openModal("message");
  });
});

          </script>
          <!-- Bootstrap JS -->
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

      </body>
      </html>